# Inline Microcode Assembly in HLSL

**Source:** http://msdn.microsoft.com/en-us/library/bb313871.aspx

The Wayback Machine - https://web.archive.org/web/20100423055133/http://msdn.microsoft.com:80/en-us/library/bb313871.aspx
XNA Game Studio 3.1
Inline Microcode Assembly in HLSL
The **asm** keyword allows Xbox 360 GPU microcode to be inserted (inline) into HLSL functions, as shown here. 
```
float4 FetchPosition( int i )
{
  float4 vertexPos;
  asm {
    vfetch vertexPos, i, position
  };
  return vertexPos;
}  
```

The inline microcode starts with **asm{** , followed by one or more microcode statements. It ends with **};**. The trailing semicolon at the end of the microcode block is always required.
The **asm** block does not contain a target such as **xvs_3_0** or **xps_3_0**. This allows the same routine to be called from both vertex shaders and pixel shaders. On Xbox 360, the **asm** block supports only [Xbox 360 microcode](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb313877.aspx).
# Sequencer Statements
  * No control flow statements are allowed. Instead, use one or more **asm** blocks with HLSL control flow.
```
for ( int i = 0; i < 2; i++ )
{
  asm {
  // one or more microcode statements
  };
};        
```



# Registers and Variables
  * The microcode must use HLSL local or global variable names. The **asm** microcode block cannot use any registers.
  * Only simple HLSL variables are allowed within the microcodeâ€”no structures or arrays. These variables can be swizzled.
  * HLSL variables can be used as the "value" part of a name-value pair in addition to being used as source and destination arguments.
```
float4 fetchS( sampler2D s, float2 uv, float offsetX )
{
  float4 result;
  asm {
    tfetch2D result, uv, s, OffsetX = offsetX
  };
  return result;
}        
```



# HLSL Variable Binding in Microcode
If a symbol is used as a microcode source, destination, or value argument, the symbol's meaning is determined as follows.
  1. If the symbol is a variable in the lexically enclosed HLSL environment, then that variable is used.
  2. If the symbol appears as a "value" argument, and the symbol matches one of the existing GPU microcode enumerated types, then that enumerated value is used.


See Also
* * *
#### Concepts
[Vertex Fetching in HLSL (xvs_3_0, xps_3_0)](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb313874.aspx)  
[Texture Fetching in HLSL (xvs_3_0, xps_3_0)](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb313873.aspx)  
[Swizzling (xvs_3_0, xps_3_0)](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb313962.aspx)  

#### Reference
[Microcode Instructions (xvs_3_0, xps_3_0)](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb313961.aspx)  

* * *
  
[MSDN Library](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/ms123401.aspx)  
[Development Tools and Languages](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/aa187916.aspx)  
[XNA Game Studio](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/aa468128.aspx)  
[XNA Game Studio 3.1](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb200104.aspx)  
[Programming Guide](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb198548.aspx)  
[Hardware and Platforms](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb975657.aspx)  
[Xbox 360 Programming](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb417501.aspx)  
[Microcode (xvs_3_0, xps_3_0)](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb313877.aspx)  
[Inline Microcode Assembly in HLSL](https://web.archive.org/web/20100423055133/http://msdn.microsoft.com/en-us/library/bb313871.aspx)
* * *
Tags: 
![](https://web.archive.org/web/20100423055133im_/http://i.msdn.microsoft.com/Global/Images/wiki.gif)
Community Content
